---
title: "推挽开漏及GPIO八大模式"
description: 
date: 2023-09-06 10:00:00 +0800
categories: [Peripheral, GPIO]
tags: [Peripheral, GPIO]
pin: false

media_subpath: ""
#
# image:
#   path: 'assets/**/**.jpg'
#   alt: Here is the text upder the image
---

## 引脚配置
微控制器通过引脚与外界连接，集成电路(IC)上的引脚可以连接到PCB的焊盘。每个引脚的在IC内部都有用于驱动的电路，引脚可以通过内部驱动电路配置，与不同类型的数字或模拟电路连接。正确配置引脚是设计嵌入式系统的重要部分。

- 高阻态（High impedance-High Z）  
>一般门与其它电路的连接，无非是两种状态，1或者0，在比较复杂的系统中，为了能在一条传输线上传送不同部件的信号，研制了相应的逻辑器件称为三态门，除了有这两种状态以外还有一个高阻态，就是高阻抗（电阻很大，相当于开路）。相当于该门和它连接的电路处于断开的状态。(因为实际电路中你不可能去断开它，所以设置这样一个状态使它处于断开状态)。三态门是一种扩展逻辑功能的输出级，也是一种控制开关。主要是用于总线的连接，因为总线只允许同时只有一个使用者。通常在数据总线上接有多个器件，每个器件通过OE/CE之类的信号选通。如器件没有选通的话它就处于高阻态，相当于没有接在总线上，不影响其它器件的工作。高阻态，主要是表示断开的，一般来说都是芯片自身的特性，在不选择该芯片时其输出为高阻态，以免影响其它设备间的通信。
>
>高阻态可理解为通过很大的电阻把输出引脚与 MCU 芯片内部隔开，近似开路的状态（电阻非常大）。这时芯片无法控制输出的电平，引脚的电平不确定，可被外部电平轻松改变(因此通常使用上拉电阻来输出高电平)。
>  
>引脚为高阻态，可有效地消除其对所连接电路的影响。除非外部电路(上拉/下拉)驱动它，否则引脚是“悬空的” 不会主动驱动。 
> 
>输出高阻态就是避免对别人产生影响，而输入高阻态，既避免对别人产生影响，又避免了受到别人的影响。  

- 悬空（Floating pin）  
>引脚未进行任何连接或不受IC驱动被称为“悬空”，“悬空”引脚的电压无法预测。高阻态引脚如果不受外部电路（上拉/下拉）驱动也被称为“悬空”。

- 上拉电阻和下拉电阻  
>上拉电阻、下拉电阻用于对“悬空”引脚（不确定的信号）设置电平（逻辑0或逻辑1）。
>
>上拉电阻连接到电源，可以将“悬空”引脚拉到高电平；下拉电阻连接到GND，可以将“悬空”引脚拉到低电平。
>  
>注意：上拉和下拉电阻电路的开关在实际应用中一般使用MOS管来代替。  
>>
>>上下拉电阻的作用  
>>1. 提高电路稳定性，避免引起误动作。  
例如按键如果不通过电阻上拉到高电平，那么在上电瞬间可能就发生误动作，因为在上电瞬间单片机的引脚电平是不确定的，上拉电阻的存在保证了引脚处于高电平状态，而不会发生误动作。  
>>2. 提高输出管脚的带载能力。  
受其他外围电路的影响，单片机在输出高电平时能力不足，达不到VCC状态，这会影响整个系统的正常工作，上拉电阻可以使管脚的驱动能力增强。这里特别强调如下：带片上I2C资源的单片机，其SCL和SDA引脚是开漏引脚，如果当做普通的GPIO来用的话，你会发现该引脚输出高电平极不稳定甚至因为负载的关系都无法正常输出高电平，这时候就需要在这两个引脚上加上拉电阻了。  

## **三态门**  
一个三态输出电路一般由一个非门、两个或非门和两个NMOS晶体管组成。NMOS晶体管可视为一个开关，当为其输入高电位时接通，而输入低电位时断开。三态输出电路原理图如图所示： 

![输入图片说明](/imgs/peripheral-gpio-mode/2023-09-07/HMMu70k6VWZNRdQ9.png)  

当E为高电位时，经非门后加到两个或非门输入端的均为低电位，此时E输出的低电平不影响或门的结果，仅与A有关。此时若A为高电位，则G2为低电位，NMOS管T2断开，G2反馈到上一个或非门后，G1为高电位，NMOS管T1导通，即B与+5V接通，B点为高电位，B=1；若A为低电位，则G2为高电位，G1为低电位，NMOS管T1断开，T2导通，即B与地接通，B点为低电位，B=0。故，当E=1时：若A=1，则B=1；若A=0，则B=0。

当E为低电位时，经非门后加到两个或非门输入端的均为高电位，经或非门后，G1，G2均为低电位，NMOS管T1与T2均断开，A和B不相通，呈现出高阻状态。

由此可知，此电路有3个状态：  
a．E=0，A和B不通，呈高阻态。  
b．E=1，A=1时，B=1。  
c．E=1，A=0时，B=0。  


## **NPN PNP三极管**   
![三极管](/imgs/peripheral-gpio-mode/2023-09-07/zrXPL4FFYCglPlyM.png)  
 
![NPN PNP三极管](/imgs/peripheral-gpio-mode/2023-09-07/0NwPyNagD45lLfGR.png)  
基极，集电极，发射极。  
三极管箭头指向是发射极的电流方向，有箭头的那个极就是发射极。    
箭头向内指的是PNP型三极管，箭头向外指的是NPN型三极管。    

## **VCC、VDD、VSS、GND**  
>VCC：C=circuit 表示电路的意思, 即接入电路的电压；   
VDD：D=device 表示器件的意思, 即器件内部的工作电压；   
VSS：S=series 表示公共连接的意思，通常指电路公共接地端电压。   
GND：在电路里常被定为电压参考基点。   
VEE：负电压供电；场效应管的源极（S）   
VBAT：当使用电池或其他电源连接到VBAT脚上时，当VDD断电时，可以保存备份寄存器的内容和维持RTC的功能。如果应用中没有使用外部电池，VBAT引脚应接到VDD引脚上。  

>1、对于数字电路来说，VCC是电路的供电电压,VDD是芯片的工作电压（通常Vcc>Vdd），VSS是接地点。   
2、有些IC既有VDD引脚又有VCC引脚，说明这种器件自身带有电压转换功能。   
3、在场效应管（或COMS器件）中，VDD为漏极，VSS为源极，VDD和VSS指的是元件引脚，而不表示供电电压。   
4、从电气意义上说，GND分为电源地和信号地。PG是 Power Ground（电源地）的缩写。另一个是 Signal Ground（信号地）。实际上它们可能是连在一起的（不一定是混在一起）。两个名称，主要是便于对电路进行分析。   
进一步说，还有因电路形式不同而必须区分的两种“地”：数字地，模拟地。数字地和模拟地都有信号地、电源地两种情况。数字地和模拟地之间，某些电路可以直接连接，有些电路要用电抗器连接，有些电路不可连接。   

## **如何正确的理解漏极开路输出跟推挽输出**  
### 说明方式1
要理解推挽输出，首先要理解好三极管（晶体管）的原理。下面这种三极管有三个端口，分别是基极（Base）、集电极（Collector）和发射极（Emitter）。下图是NPN型晶体管。  

![输入图片说明](/imgs/peripheral-gpio-mode/2023-09-07/a8izopIAXOc6BaTH.png)  

这种三极管是电流控制型元器件，注意关键词电流控制。意思就是说，只要基极B有输入（或输出）电流就可以对这个晶体管进行控制了。

下面请允许我换一下概念，把基极B视为控制端，集电极C视为输入端，发射极E视为输出端。这里输入输出是指电流流动的方向。

![输入图片说明](/imgs/peripheral-gpio-mode/2023-09-07/ZzuMJxAhDQE8dMxC.png)  

当控制端有电流输入的时候，就会有电流从输入端进入并从输出端流出。  
![输入图片说明](/imgs/peripheral-gpio-mode/2023-09-07/pl9EwWEIFZxqXAEA.png)  

而PNP管正好相反，当有电流从控制端流出时，就会有电流从输入端流到输出端。  
![输入图片说明](/imgs/peripheral-gpio-mode/2023-09-07/W1ZFzz6EK91TCGl5.png) 

那么推挽电路：  
![输入图片说明](/imgs/peripheral-gpio-mode/2023-09-07/CbLJtDE5tLCTQ3HX.png)  

上面的三极管是N型三极管，下面的三极管是P型三极管，请留意控制端、输入端和输出端。  

当Vin电压为V+时，上面的N型三极管控制端有电流输入，Q3导通，于是电流从上往下通过，提供电流给负载。    
![输入图片说明](/imgs/peripheral-gpio-mode/2023-09-07/KuvsT1LbjOdvCgbs.png)  

经过上面的N型三极管提供电流给负载（Rload），这就叫「**推**」。

当Vin电压为V-时，下面的三极管有电流流出，Q4导通，有电流从上往下流过。  
![输入图片说明](/imgs/peripheral-gpio-mode/2023-09-07/2ApwMDJ6Q9TicoAJ.png)

经过下面的P型三极管提供电流给负载（Rload），这就叫「**挽**」。

以上就是推挽（push-pull）电路。

那么什么是开漏（open drain, OD电路）呢？

漏极开路（Open Drain）和集电极开路（Open Collector），电路概念中漏极开路提到的“漏”是指MOSFET的漏极。同理，集电极开路电路中的“集”就是指三极管的集电极。在数字电路中，分别简称OD门和OC门。

要理解开漏，可以先理解开集。   

![输入图片说明](/imgs/peripheral-gpio-mode/2023-09-07/WXKGIgu96YW8ZJ21.png)  
如图，开集的意思，就是集电极C一端什么都不接，直接作为输出端口。  

如果要用这种电路带一个负载，比如一个LED，必须接一个上拉电阻，就像这样。  
![输入图片说明](/imgs/peripheral-gpio-mode/2023-09-07/RxHIxIoKQsoGD4i0.png)  
当Vin没有电流，Q5断开时，LED亮。  
当Vin流入电流，Q5导通时，LED灭。  

开漏电路，就是把上图中的三极管换成场效应管（MOSFET）。

N型场效应管各个端口的名称：  
![输入图片说明](/imgs/peripheral-gpio-mode/2023-09-07/x8CeEcfmDk4rBvm1.png)  
场效应管是电压控制型元器件，只要对栅极施加电压，DS就会导通。  

结型场效应管有一个特性就是它的输入阻抗非常大，这意味着：没有电流从控制电路流出，也没有电流进入控制电路。没有电流流入或流出，就不会烧坏控制电路。而双极型晶体管不同，是电流控制性元器件，如果使用开集电路，可能会烧坏控制电路。这大概就是我们总是听到开漏电路而很少听到开集电路的原因吧？因为开集电路被淘汰了。  

### 说明方式2

另一种说明：  
![输入图片说明](/imgs/peripheral-gpio-mode/2023-09-07/2hz8ffiqJNbb3BKC.png)  
我们先来说说集电极开路输出的结构。集电极开路输出的最基本的电路如图1所示，右边的那个三极管集电极什么都不接，所以叫做集电极开路（左边的三极管为反相之用，使输入为"0"时，输出也为"0"）。对于图1，当左端的输入为“0”时，前面的三极管截止（即集电极C跟发射极E之间相当于断开），所以5V电源通过1K电阻加到右边的三极管上，右边的三极管导通（即相当于一个开关闭合），输出电平为0；当左端的输入为“1”时，前面的三极管导通，而后面的三极管截止（相当于开关断开），输出高阻态。

我们将图1简化成图2的样子。图2中的开关受软件控制，“1”时断开，“0”时闭合。很明显可以看出，当开关闭合时，输出直接接地，所以输出电平为0。而当开关断开时，则输出端悬空了，即高阻态。这时电平状态未知，如果后面一个电阻负载（即使很轻的负载）到地，那么输出端的电平就被这个负载拉到低电平了，所以这个电路是不能输出高电平的。

再看图三。图三中那个1K的电阻即是上拉电阻。如果开关闭合，则有电流从1K电阻及开关上流过，但由于开关闭合时电阻为0（方便我们的讨论，实际情况中开关电阻不为0，另外对于三极管还存在饱和压降），所以在开关上的电压为0，即输出电平为0。如果开关断开，则由于开关电阻为无穷大（同上，不考虑实际中的漏电流），所以流过的电流为0，因此在1K电阻上的压降也为0，所以输出端的电压就是5V了，这样就能输出高电平了。但是这个输出的内阻是比较大的（即1KΩ），如果接一个电阻为R的负载，通过分压计算，就可以算得最后的输出电压为5*R/(R+1000)伏，即5/(1+1000/R)伏。所以，如果要达到一定的电压的话，R就不能太小。如果R真的太小，而导致输出电压不够的话，那我们只有通过减小那个1K的上拉电阻来增加驱动能力。但是，上拉电阻又不能取得太小，因为当开关闭合时，将产生电流，由于开关能流过的电流是有限的，因此限制了上拉电阻的取值，另外还需要考虑到，当输出低电平时，负载可能还会给提供一部分电流从开关流过，因此要综合这些电流考虑来选择合适的上拉电阻。

对于漏极开路（OD）输出，跟集电极开路输出是十分类似的。将上面的三极管换成场效应管即可。这样集电极就变成了漏极，OC就变成了OD，原理分析是一样的。


### 应用的角度  
1. 推挽输出能够输出高或者低，而开漏输出其本身只能输出低，或者关闭输出，因此如果要想输出高电平，可以在输出端接上拉电阻，开漏输出总是要配一个上拉电阻使用。
2. 上拉电阻R的阻值决定了逻辑电平转换的上升/下降沿的速度。阻值越大，速度越低，功耗越小。因此在选择上拉电阻时要兼顾功耗和速度。开漏输出的上拉电阻不能太小，太小的话，当开漏输出的下管导通时，电源到地的电压在电阻上会造成很大的功耗，因此这个电阻阻值通常在10k以上，这样的开漏输出在从输出低电平切换到高电平时，速度是很慢的。
3. 推挽输出任意时刻的输出要么是高，要么是低，所以不能将多个输出短接，而开漏输出可以将多个输出短接，共用一个上拉，此时这些开漏输出的驱动其实是与非的关系。
4. 推挽输出输出高时，其电压等于推挽电路的电源，通常为一个定值，而开漏输出的高取决于上拉电阻接的电压(开漏输出本身不能输出高电平，只能输出低电平和高阻态)，不取决于前级电压，所以经常用来做电平转换，用低电压逻辑驱动高电压逻辑，比如3.3v带5v。

对于驱动设备的IO来说，在不知道被驱动设备是多少V作为逻辑高输入，0V为逻辑低大多数情况下通用，OD是个非常好的选择，因为可以自由选择外部上拉电阻的上拉电压，只要不超过驱动设备的IO容限，完全可以任意选择。举个例子，假如有两个设备需要驱动，一个要5V的，一个要3.3V的，我可以选择一个OD引脚上拉3.3V，另一个上拉5V。但是推挽就麻烦了，两个推挽引脚，做在芯片内部，通常是统一的高电平，面对两种驱动电平的时候，就只能使用外置电平转换。  

开漏输出可以防止短路: 在一些情况下(比如总线), 多个GPIO口可能会连接在同一根线上, 存在某个GPIO输出高电平, 另一个GPIO输出低电平的情况. 如果使用推挽输出, 你会发现这个GPIO的VCC和另一个GPIO的GND接在了一起, 也就是短路了(凉凉了)。如果换成开漏输出呢? VCC和GND多了个电阻, 这样电路就是安全的，所以总线一般会使用开漏输出。  
![输入图片说明](/imgs/peripheral-gpio-mode/2023-09-07/nhnQK7ScJjC0nZih.png)  

推挽电路同样有着自己的设计目的，就是弥补OD带来的缺陷，包括以下几点  
1. OD的上拉电阻占用空间，推挽内置。
2. OD的IO电平反转速率不够，通常做到2M，推挽轻松50M甚至更高。
3. OD带负载的能力不如推挽。

## **推挽 开漏**  
**推挽 Push Pull**  
推挽是最常见的输出配置。顾名思义，推挽输出能够驱动两种输出电平。一个是连接到地的“挽“(从负载上挽/吸收电流)，另一个是连接到电源的”“推(向负载上推/输出电流)。推挽输出可以通过对IC内部的晶体管控制来进行设置。  

推挽输出不支持“线与”，推挽输出常用于单线单向传输（SPI、UART）。

推挽输出的驱动是连续的（高电平或低电平），输出的数字信号的斜率的性能更好。

**开漏 Open Drain**  
开漏引脚内部只能驱动引脚与GND连接(MOS管源极一侧)。

使用NMOS晶体管开漏输出，当晶体管导通时将输出引脚与GND连接(输出低电平)；当晶体管截止时输出引脚“悬空”，输出引脚变为高阻抗状态。添加外部上拉电阻可以使其具有高电平输出能力（非自身的输出）。

开漏输出使用上拉电阻时，有几点注意事项:  
- 上升沿斜率-上拉电阻与线路的电容结合形成低通滤波器，根据电阻阻值和线路的电容，上升沿和下降沿的斜率会有明显的不同。因为晶体管内阻非常低，所以下降沿是垂直；上升沿是由上拉电阻形成的，所以低通滤波效果更加明显。
- 功耗和噪声干扰-需要对上拉电阻阻值进行合理选择。当线路上的设备为低电平时，上拉电阻阻值较低时线路上产生较大电流，流经电阻的电流较大，因此增加功耗；上拉电阻阻值较高时线路上产生较小电流，线路更容易受到外部的干扰（噪声）影响。

开漏输出支持“线与”，开漏输出常用于单线双向传输(I2C, One-Wire)。正是由于开漏输出的「要么拉低要么放手」的特性，使得总线只受输出端低电平的影响（同样，设备也只能通过输出低电平来使用总线）。I2C 总线电路的真正主角，是连接总线到 VCC 的两个上拉电阻。开漏输出端只能输出低电平或高阻态，是不能把总线拉高的，自然而然就需要通过其他方式为总线提供高电平，上拉电阻就担负了这个重任——当输出端输出高阻态且没有其他设备拉低总线（占用总线）时，总线被外部的上拉电阻拉高，呈现出高电平状态。总线上任何一个设备都可以使用开漏输出将总线变为低电平，并且所有其他设备都会检测到低电平。

但推挽输出的一个缺点是，如果当两个推挽输出结构相连在一起，一个输出高电平，即上面的MOS导通，下面的MOS闭合时；同时另一个输出低电平，即上面的MOS闭合，下面的MOS导通时。电流会从第一个引脚的VCC通过上端MOS再经过第二个引脚的下端MOS直接流向GND。整个通路上电阻很小，会发生短路，进而可能造成端口的损害。这也是为什么推挽输出不能实现" 线与"的原因。

**总结**
- 推挽输出更适合单线单向通信(SPI, UART)；开漏输出更适合双向单线通信(I2C, One-Wire)；
- 推挽输出没有使用上拉电阻功耗更低；开漏输出由于使用上拉电阻功耗更高；
- 推挽输在信号的斜率性的能更强；推挽输在信号的斜率性的能更弱。

## **深刻理解GPIO(上拉输入、下拉输入、模拟输入、浮空输入，开漏输出，推挽输出的区别，以STM32为例)**  
![输入图片说明](/imgs/peripheral-gpio-mode/2023-09-07/VaJ5ucVybaQQhZBE.png)  
GPIO的配置可以分成8种模式，4种输入，4种输出。  
输入分为：模拟输入、浮空输入、上拉输入、下拉输入  
输出分为：开漏输出、推挽输出、复用推挽输出、复用开漏输出  
（复用功能可以理解为普通的GPIO口被用作第二功能时的配置情况（即并非作为通用IO口使用），复用功能模式中，一般从复用的外设寄存器中获取待输出数据信号。）  

>模拟输入，一般情况下，用于ADC的采集电压时。在模拟输入中，TTL肖特基触发器以及上拉电阻和下拉电阻都处于关闭状态。即使配置上拉或下拉模式，不会影响到模拟信号的输入输出。 
> 
>浮空输入，IO的电平状态是不确定的，完全由外部输入决定，如果该引脚悬空的情况下，读取该端口的电平是不确定的，有可能是高电平，也有可能是低电平。浮空输入一般多用于外部按键输入  
>
>上拉输入，将一个不确定的信号，通过一个电阻与电源VCC相连，将IO口默认固定在高电平。上拉电阻的作用是为了确保信号输入时输入端的电平为高电平。  
>
>下拉输入，将一个不确定的信号，通过一个电阻与地GND相连，将IO口默认固定在低电平。下拉电阻的作用是为了确保信号输入时输入端的电平为低电平。  
>
>开漏输出，在这个模式下，自身只能够输出低电平，但无法真正输出高电平，需要借助外部上拉电阻完成对外驱动。同时，P-MOS管是处于关闭的，N-MOS管是开启的。当输出寄存器的值为0的时候，N-MOS管导通，此时IO口的电平被N-MOS管拉到VSS，输出为低电平。当输出寄存器为1的时候，N-MOS管截止，IO口直接和输出端断开了，处于浮空状态。
>  
>推挽输出，它的P-MOS管和N-MOS管是打开的状态，当输出寄存器的值为0的时候，N-MOS管导通，此时IO口的电平被N-MOS管拉到VSS，输出为低电平。当输出寄存器为1的时候，P-MOS管导通，此时IO口的电平被P-MOS管拉到VDD，输出为高电平。简单点讲就是想输出高电平，就输出高电平，想输出低电平，就输出低电平。  
>（开漏输出和推挽输出的区别：开漏输出只有N-MOS管是开启的，P-MOS管是关闭的。）
>  
>复用开漏输出模式，与开漏输出模式很是相似。只是输出的高低电平的来源不同，不是让CPU写输出数据寄存器了，而是用片内外设模块的复用功能输出来决定的。复用开漏输出中的片内外设功能（TX1,MOSI,MISO.SCK.SS）。  
>
>复用推挽输出模式，与推挽输出模式也是相似。输出的高低电平的来源不同，不是让CPU写输出数据寄存器，而是利用片内外设模块的复用功能输出来决定的。复用推挽输出中的片内外设功能（I2C的SCL,SDA）。  

注意：上拉和下拉电阻电路的开关在实际应用中一般使用MOS管来代替。

>施密特触发器  
>对于标准施密特触发器，当输入电压高于正向阈值电压，输出为高；当输入电压低于负向阈值电压，输出为低。输出由高电准位翻转为低电准位，或是由低电准位翻转为高电准位对应的阈值电压是不同的。只有当输入电压发生足够的变化时，输出才会变化，因此将这种元件命名为触发器。这种双阈值动作被称为迟滞现象，表明施密特触发器有记忆性。从本质上来说，施密特触发器是一种双稳态多谐振荡器。  
>施密特触发器可作为波形整形电路，能将模拟信号波形整形为数字电路能够处理的方波波形，而且由于施密特触发器具有滞回特性，所以可用于抗干扰，其应用包括在开回路配置中用于抗扰，以及在闭回路正回授/负回授配置中用于实现多谐振荡器。

>- 浮空输入  
>浮空输入走的这一条路径，是对一个数字信号的读取。  
>VDD和VSS所在路径的两个开关同时断开。此时没有上拉和下拉的情况，所以当IO口没有接输入的时候，此时的电平会是一个不确定的值，也就是我们所说的浮空。电平会处于一个跳变的状态，一会高，一会低。只有输入了一个高/低电平才会确定下来。再往前面走，就是走到了TTL施密特触发器这一个部分。我们知道，由于电源的特性，或者是由于外部开关输入的特性，输入的数字信号，极有可能会出现脉冲等噪声的影响，为了让我们的波形更好看，或者信号更加清晰，所以就设置了TTL施密特触发器这个东西。经过之后，我们就会把这个数字信息存储在输入数据寄存器中。这样我们就读到了IO过来的数字信号  
>优势：这一种输入模式的电平会完全取决于外部电路而与内部电路无关。有时候会用作对开关按键的读取。  
>但是在没有外部电路接入的时候，IO脚浮空会使得电平不确定  
>
>- 上拉输入  
>上拉输入是对一个数字信号的读取。  
>VDD所在上拉电阻开关闭合，下拉电阻的开关断开。在没有信号输入的时候，电平是VDD的电平，此时读取到的电平是高电平。如果输入了一个高电平，VDD和O点(最上面的图中的O点)之间就几乎没有电势差，此时O点的电平就仍然是高电平，读取到的电平就是高电平。但是由于在没有电压输入的时候，电平也是高电平，所以这一种输入情况下是没有办法确定信号是否输入了。当输入信号是一个低电平的时候，此时O点的电平的电平就会变成低电平，那么VDD和O点之间形成了电势差，但是因为上拉电阻的存在，所以不会出现一个大电流。此时单片机读取到的一个电平就是一个低电平。在上拉输入的情况下，低电平能够非常明显的读取到。  
>上拉输入的好处就是输入的电平不会上下浮动而导致输入信号不稳定，在没有信号输入的情况下可以稳定在高电平。  
>
>- 下拉输入  
>下拉输入是对一个数字信号的读取。  
>VDD所在上拉电阻开关断开，下拉电阻的开关闭合。在没有信号输入的时候，电平是VSS的电平，此时读取到的电平是低电平。输入的电平如果是一个低电平，就没有办法和之前的情况进行区分。但如果输入的是一个高电平，O点和VSS之间同样形成了电势差，O点的电平会变成外部的高电平，那么单片机得到的就是一个高电平信号。  
>下拉输入的好处就是输入的电平不会上下浮动而导致输入信号不稳定，在没有信号输入的情况下可以稳定在低电平。  
>
>- 模拟输入    
>模拟输入是对一个模拟信号进行读取。  
>在我们使用单片机的时候，我们有时候需要用AD采集到IO口上面的真实电压。这就有了我们所需要的模拟输入。为了让外部的电压真实的读取到单片机的AD模块，我们既不能闭合上拉和下拉的开关，也不能让信号经过施密特触发器。  
>优势：可以让AD读取电压。还可以在低功耗模式下运行，实现省电的作用。  
>
>- 推挽输出  
>利用内部两个不同的MOS管来实现高低电平输出
>
>- 开漏输出  
>本身只能输出低电平，但是加上拉电阻后，就可以输出高电平。    
>开漏输出没有办法在内部输出一个高电平，这一个看似是缺点。实际上是一种优点。我们可以得到，当给一个低电平的时候，MOS管没有导通，此时电压不确定导致无法输出高电平，但是一旦我们在外部增加一个上拉，那么这一个缺点就会被有效避免。并且，因为是我们自己设计一个上拉，这个上拉的电压是由我们自己确定，这样我们就可以根据外部电路需要多少V的高电平来给这一个上拉的电压，可以更好的适应更多情况。
>
>- 复用开漏输出  
>复用开漏输出模式与开漏输出相似。只是输出的高低电平的来源不同，不是让CPU写输出数据寄存器了，而是用片内外设模块的复用功能输出来决定的。复用开漏输出中的片内外设功能（TX1,MOSI,MISO,SCK,SS）。
>
>- 复用推挽输出
>复用推挽输出与推挽输出相似。只是输出的高低电平的来源不同，不是让CPU写输出数据寄存器，而是利用片内外设模块的复用功能输出来决定的。复用推挽输出中的片内外设功能（I2C的SCL,SDA）。

## **如何理解STM32单片机引脚的复用功能？**  
我们知道STM32Fxx单片机还有复用开漏输出和复用推挽输出，它们和上面讲到的（普通）开漏输出和（普通）推挽输出有什么区别呢？  

这就涉及到针脚的复用功能。

我们知道，STM32Fxx内部集成了很多的外设控制器，比如USART、SPI、bxCAN等等，这些外设控制器，也需要通过引脚与外设连接。复用功能是相对于单片机的引脚而言的。所谓“复用功能”，是指单片机的引脚既可以做普通GPIO使用，也可以作为内部外设控制器的引脚来使用。比如我们来看看STM32F103xx单片机的PA5引脚。首先，PA5可以做为普通GPIO来使用；其次，如果作为外设的引脚，它可以作为SPI1的时钟（SPI1_SCK）、DAC的输出通道1（DAC_OUT1）或者ADC的输入通道5（ADC12_IN5）。PA5支持的三种外设（SPI1、DAC、ADC）在同一时刻只能选择一种，选择的方法是开启相应外设的时钟，并使其它外设的时钟保持关闭状态。如果PA5被配置为复用功能，但是没有开启它支持的任何外设的时钟，它的输出是不确定的。

复用推挽输出和（普通）推挽输出在输出的时候均使用两个MOS管（P-MOS和-MOS），其输出电路是相同的。区别在于控制输出的信号来源：（普通）推挽输出控制MOS管的信号来自输出数据寄存器，而复用推挽输出的控制信号来自单片机的内置外设控制器（比如SPI1）。复用开漏输出和（普通）开漏输出的道理是一样的。

下面这张图，是普通GPIO输出的引脚配置图，可以看到其输出信号来自输出数据寄存器（Output data register）：  
![输入图片说明](/imgs/peripheral-gpio-mode/2023-09-07/09BukGV13dyBwTnS.png)  
下面这张图，是选择复用功能后的引脚配置图，可以看到其输出信号来自芯片内置的外设控制器：  
![输入图片说明](/imgs/peripheral-gpio-mode/2023-09-07/kUg0RmKdsMP0iu9W.png)  

## Reference
- [# 实用电子元器件与电路基础](https://book.douban.com/subject/3639214/)
- [# 如何正确的理解漏极开路输出跟推挽输出](https://www.zhihu.com/question/28512432)  
- [# 深刻理解GPIO](https://blog.csdn.net/scarecrow_sun/article/details/120287852)  
- [# STM32的GPIO端口配置八种模式的理解](https://blog.csdn.net/qq_62016408/article/details/126051580) 
- [# 如何理解STM32单片机引脚的复用功能](https://zhuanlan.zhihu.com/p/32346166)  