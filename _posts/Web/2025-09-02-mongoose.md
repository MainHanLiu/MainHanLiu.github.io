---
title: "Mongoose：嵌入式web服务器(embedded web server)"
description: 
date: 2025-09-02 10:00:00 +0800
categories: [WEB]
tags: [WEB]
pin: false

media_subpath: ""
#
# image:
#   path: 'assets/**/**.jpg'
#   alt: Here is the text under the image
---

## Mongoose
[Mongoose](https://mongoose.ws/)是一个c/c++的开源网络库，它支持TCP、UDP、HTTP、WebSocket、MQTT协议，API实现基于事件驱动、非阻塞的方式。Mongoose是非常轻量级的库，具有非常好的跨平台特性，特别是在嵌入式领域支持非常多的嵌入式架构。从官网介绍来看，无论是开源项目还是商业项目都有大量的应用，甚至国际空间站都运行着Mongoose。Mongoose可以让嵌入式网络编程很快速、很健壮且很容易。

[User Guide](https://mongoose.ws/documentation/#user-guide)

[User Guide-HTTP](https://mongoose.ws/documentation/#http)
[User Guide-HTTP-File Uploads](https://mongoose.ws/documentation/tutorials/http/file-uploads/)

[tutorials/http/http-server](https://mongoose.ws/documentation/tutorials/http/http-server/)  


最佳实践为[混合服务器（Hybrid server）](https://mongoose.ws/documentation/tutorials/http/http-server/#hybrid-server)。在这种情况下，事件处理程序函数将把某些uri作为动态处理，对于其余的uri，只需调用mg_http_serve_dir()获取静态资源。  
>静态，如HTML、CSS、JavaScript、图片等  
>动态，如服务器通过JSON返回动态数据  
```c
#include "mongoose.h"

static void ev_handler(struct mg_connection *c, int ev, void *ev_data) {
  if (ev == MG_EV_HTTP_MSG) {
    struct mg_http_message *hm = (struct mg_http_message *) ev_data;
    if (mg_match(hm->uri, mg_str("/api/stats"), NULL)) {
      // Print some statistics about currently established connections
    } else if (mg_match(hm->uri, mg_str("/api/f2/*"), NULL)) {
      mg_http_reply(c, 200, "", "{\"result\": \"%.*s\"}\n", (int) hm->uri.len,
                    hm->uri.buf);
    } else {
      struct mg_http_serve_opts opts = {.root_dir = s_root_dir}; // 静态资源地址 如app/www/htdocs
      mg_http_serve_dir(c, ev_data, &opts);
    }
  }
}

int main(int argc, char *argv[]) {
  struct mg_mgr mgr;  // Event manager
  mg_mgr_init(&mgr);  // Inititialise event manager

  // Setup listener
  mg_http_listen(&mgr, "0.0.0.0:80", ev_handler, NULL); 
  // 0.0.0.0 是一个特殊的 IP 地址，表示“监听所有可用的网络接口”
  // 80 是 HTTP 协议的默认端口
  // 使用默认端口可以避免用户在访问时需要显式指定端口
  // 例如，浏览器默认访问 http://example.com 时尝试 80 端口

  // Event loop
  for (;;) {
    mg_mgr_poll(&mgr, 1000);  
  }

  // Cleanup
  mg_mgr_free(&mgr);          
  return 0;
}
```

### Mongoose 上传事件流程概览
Mongoose 在上传 multipart/form-data 文件时，会依次触发这些事件：
| 事件                                 | 含义                   |
| ---------------------------------- | -------------------- |
| `MG_EV_HTTP_MULTIPART_REQUEST`     | 收到上传请求的起始部分（HTTP 头部） |
| `MG_EV_HTTP_PART_BEGIN`            | 开始接收一个文件             |
| `MG_EV_HTTP_PART_DATA`             | 接收到文件数据块（可能多次触发）     |
| `MG_EV_HTTP_PART_END`              | 一个文件传输结束             |
| `MG_EV_HTTP_MULTIPART_REQUEST_END` | 整个上传请求结束（所有文件都传完）    |


## API
[API-CORE](https://mongoose.ws/documentation/#core-1)

[API-HTTP](https://mongoose.ws/documentation/#http-1)

### js前端分片传输大文件+mongoose后端解析
[js前端分片传输大文件+mongoose后端解析](https://blog.csdn.net/qq_30757815/article/details/147870694)

## 模拟HTTP请求工具 PostMan 
[PostMan](https://www.postman.com/downloads/)

[Postman中文文档](https://postman.xiniushu.com/)


## openssl?
