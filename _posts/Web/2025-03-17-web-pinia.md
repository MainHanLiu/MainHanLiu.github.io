---
title: "Piniaâ€”â€”ç¬¦åˆç›´è§‰çš„Vue.jsçŠ¶æ€ç®¡ç†åº“"
description: 
date: 2025-03-17 10:00:00 +0800
categories: [WEB]
tags: [WEB, pinia]
pin: false

media_subpath: ""
#
# image:
#   path: 'assets/**/**.jpg'
#   alt: Here is the text under the image
---

>ç±»å‹å®‰å…¨ã€å¯æ‰©å±•æ€§ä»¥åŠæ¨¡å—åŒ–è®¾è®¡ã€‚ç”šè‡³è®©ä½ å¿˜è®°æ­£åœ¨ä½¿ç”¨çš„æ˜¯ä¸€ä¸ªçŠ¶æ€åº“ã€‚

## ä»‹ç»
### å®‰è£… ä½¿ç”¨

```sh
npm install pinia
```

```ts
import { createApp } from 'vue'
import { createPinia } from 'pinia'
import App from './App.vue'

const pinia = createPinia()
const app = createApp(App)

app.use(pinia)
app.mount('#app')
```

### Store æ˜¯ä»€ä¹ˆï¼Ÿ
Store (å¦‚ Pinia) æ˜¯ä¸€ä¸ªä¿å­˜çŠ¶æ€å’Œä¸šåŠ¡é€»è¾‘çš„å®ä½“ï¼Œå®ƒå¹¶ä¸ä¸ä½ çš„ç»„ä»¶æ ‘ç»‘å®šã€‚æ¢å¥è¯è¯´ï¼Œå®ƒæ‰¿è½½ç€å…¨å±€çŠ¶æ€ã€‚å®ƒæœ‰ç‚¹åƒä¸€ä¸ªæ°¸è¿œå­˜åœ¨çš„ç»„ä»¶ï¼Œæ¯ä¸ªç»„ä»¶éƒ½å¯ä»¥è¯»å–å’Œå†™å…¥å®ƒã€‚å®ƒæœ‰ä¸‰ä¸ªæ¦‚å¿µï¼Œ**state**ã€**getter** å’Œ **action**ï¼Œæˆ‘ä»¬å¯ä»¥å‡è®¾è¿™äº›æ¦‚å¿µç›¸å½“äºç»„ä»¶ä¸­çš„ dataã€ computed å’Œ methodsã€‚

### åº”è¯¥åœ¨ä»€ä¹ˆæ—¶å€™ä½¿ç”¨ Store?
ä¸€ä¸ª Store åº”è¯¥åŒ…å«å¯ä»¥åœ¨æ•´ä¸ªåº”ç”¨ä¸­è®¿é—®çš„æ•°æ®ã€‚è¿™åŒ…æ‹¬åœ¨è®¸å¤šåœ°æ–¹ä½¿ç”¨çš„æ•°æ®ï¼Œä¾‹å¦‚æ˜¾ç¤ºåœ¨å¯¼èˆªæ ä¸­çš„ç”¨æˆ·ä¿¡æ¯ï¼Œä»¥åŠéœ€è¦é€šè¿‡é¡µé¢ä¿å­˜çš„æ•°æ®ï¼Œä¾‹å¦‚ä¸€ä¸ªéå¸¸å¤æ‚çš„å¤šæ­¥éª¤è¡¨å•ã€‚

å¦ä¸€æ–¹é¢ï¼Œä½ åº”è¯¥é¿å…åœ¨ Store ä¸­å¼•å…¥é‚£äº›åŸæœ¬å¯ä»¥åœ¨ç»„ä»¶ä¸­ä¿å­˜çš„æœ¬åœ°æ•°æ®ï¼Œä¾‹å¦‚ï¼Œä¸€ä¸ªå…ƒç´ åœ¨é¡µé¢ä¸­çš„å¯è§æ€§ã€‚

å¹¶éæ‰€æœ‰çš„åº”ç”¨éƒ½éœ€è¦è®¿é—®å…¨å±€çŠ¶æ€ï¼Œä½†å¦‚æœä½ çš„åº”ç”¨ç¡®å®éœ€è¦ä¸€ä¸ªå…¨å±€çŠ¶æ€ï¼Œé‚£ Pinia å°†ä½¿ä½ çš„å¼€å‘è¿‡ç¨‹æ›´è½»æ¾ã€‚

## æ ¸å¿ƒæ¦‚å¿µ
### Store
#### å®šä¹‰ Store
Store æ˜¯ç”¨ defineStore() å®šä¹‰çš„ï¼Œå®ƒçš„**ç¬¬ä¸€ä¸ªå‚æ•°**è¦æ±‚æ˜¯ä¸€ä¸ªç‹¬ä¸€æ— äºŒçš„åå­—(ç¤ºä¾‹ä¸ºalerts)ï¼š
```js
import { defineStore } from 'pinia'

// ä½ å¯ä»¥ä»»æ„å‘½å `defineStore()` çš„è¿”å›å€¼ï¼Œä½†æœ€å¥½ä½¿ç”¨ store çš„åå­—ï¼ŒåŒæ—¶ä»¥ `use` å¼€å¤´ä¸”ä»¥ `Store` ç»“å°¾ã€‚
// (æ¯”å¦‚ `useUserStore`ï¼Œ`useCartStore`ï¼Œ`useProductStore`)
// ç¬¬ä¸€ä¸ªå‚æ•°æ˜¯ä½ çš„åº”ç”¨ä¸­ Store çš„å”¯ä¸€ IDã€‚
export const useAlertsStore = defineStore('alerts', {
  // å…¶ä»–é…ç½®...
})
```
alertsè¿™ä¸ªåå­— ï¼Œä¹Ÿè¢«ç”¨ä½œ id ï¼Œæ˜¯å¿…é¡»ä¼ å…¥çš„ï¼Œ Pinia å°†ç”¨å®ƒæ¥è¿æ¥ store å’Œ devtoolsã€‚ä¸ºäº†å…»æˆä¹ æƒ¯æ€§çš„ç”¨æ³•ï¼Œå°†è¿”å›çš„å‡½æ•°å‘½åä¸º use... æ˜¯ä¸€ä¸ªç¬¦åˆç»„åˆå¼å‡½æ•°é£æ ¼çš„çº¦å®šã€‚

defineStore() çš„**ç¬¬äºŒä¸ªå‚æ•°**å¯æ¥å—ä¸¤ç±»å€¼ï¼šSetup å‡½æ•°æˆ– Option å¯¹è±¡ï¼ˆä¸¤ç§å®šä¹‰æ–¹å¼ï¼‰ã€‚

1. Option Store  
ä¸ Vue çš„é€‰é¡¹å¼ API ç±»ä¼¼ï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥ä¼ å…¥ä¸€ä¸ªå¸¦æœ‰ stateã€actions ä¸ getters å±æ€§çš„ Option å¯¹è±¡
```js
export const useCounterStore = defineStore('counter', {
  state: () => ({ count: 0, name: 'Eduardo' }),
  getters: {
    doubleCount: (state) => state.count * 2,
  },
  actions: {
    increment() {
      this.count++
    },
  },
})
```
ä½ å¯ä»¥è®¤ä¸º state æ˜¯ store çš„æ•°æ® (data)ï¼Œgetters æ˜¯ store çš„è®¡ç®—å±æ€§ (computed)ï¼Œè€Œ actions åˆ™æ˜¯æ–¹æ³• (methods)ã€‚

2. Setup Store  
ä¹Ÿå­˜åœ¨å¦ä¸€ç§å®šä¹‰ store çš„å¯ç”¨è¯­æ³•ã€‚ä¸ Vue ç»„åˆå¼ API çš„ setup å‡½æ•° ç›¸ä¼¼ï¼Œæˆ‘ä»¬å¯ä»¥ä¼ å…¥ä¸€ä¸ªå‡½æ•°ï¼Œè¯¥å‡½æ•°å®šä¹‰äº†ä¸€äº›å“åº”å¼å±æ€§å’Œæ–¹æ³•ï¼Œå¹¶ä¸”è¿”å›ä¸€ä¸ªå¸¦æœ‰æˆ‘ä»¬æƒ³æš´éœ²å‡ºå»çš„å±æ€§å’Œæ–¹æ³•çš„å¯¹è±¡ã€‚

```js
export const useCounterStore = defineStore('counter', () => {
  const count = ref(0)
  const doubleCount = computed(() => count.value * 2)
  function increment() {
    count.value++
  }

  return { count, doubleCount, increment }
})
```
åœ¨ Setup Store ä¸­ï¼š
* ref() å°±æ˜¯ state å±æ€§
* computed() å°±æ˜¯ getters
* function() å°±æ˜¯ actions

æ³¨æ„ï¼Œè¦è®© pinia æ­£ç¡®è¯†åˆ« stateï¼Œä½ å¿…é¡»åœ¨ setup store ä¸­è¿”å› state çš„æ‰€æœ‰å±æ€§ã€‚è¿™æ„å‘³ç€ï¼Œä½ ä¸èƒ½åœ¨ store ä¸­ä½¿ç”¨ç§æœ‰å±æ€§ã€‚ä¸å®Œæ•´è¿”å›ä¼šå½±å“ SSR ï¼Œå¼€å‘å·¥å…·å’Œå…¶ä»–æ’ä»¶çš„æ­£å¸¸è¿è¡Œã€‚

Setup store æ¯” Option Store å¸¦æ¥äº†æ›´å¤šçš„çµæ´»æ€§ï¼Œå› ä¸ºä½ å¯ä»¥åœ¨ä¸€ä¸ª store å†…åˆ›å»ºä¾¦å¬å™¨ï¼Œå¹¶è‡ªç”±åœ°ä½¿ç”¨ä»»ä½•ç»„åˆå¼å‡½æ•°ã€‚ä¸è¿‡ï¼Œè¯·è®°ä½ï¼Œä½¿ç”¨ç»„åˆå¼å‡½æ•°ä¼šè®© SSR å˜å¾—æ›´åŠ å¤æ‚ã€‚

Setup store ä¹Ÿå¯ä»¥ä¾èµ–äºå…¨å±€æä¾›çš„å±æ€§ï¼Œæ¯”å¦‚è·¯ç”±ã€‚ä»»ä½•åº”ç”¨å±‚é¢æä¾›çš„å±æ€§éƒ½å¯ä»¥åœ¨ store ä¸­ä½¿ç”¨ inject() è®¿é—®ï¼Œå°±åƒåœ¨ç»„ä»¶ä¸­ä¸€æ ·ï¼š
```js
import { inject } from 'vue'
import { useRoute } from 'vue-router'
import { defineStore } from 'pinia'

export const useSearchFilters = defineStore('search-filters', () => {
  const route = useRoute()
  // è¿™é‡Œå‡å®š `app.provide('appProvided', 'value')` å·²ç»è°ƒç”¨è¿‡
  const appProvided = inject('appProvided')

  // ...

  return {
    // ...
  }
})
```

#### ä½¿ç”¨ Store
è™½ç„¶æˆ‘ä»¬å‰é¢å®šä¹‰äº†ä¸€ä¸ª storeï¼Œä½†åœ¨æˆ‘ä»¬ä½¿ç”¨ `<script setup>` è°ƒç”¨ useStore()(æˆ–è€…ä½¿ç”¨ setup() å‡½æ•°ï¼Œåƒæ‰€æœ‰çš„ç»„ä»¶é‚£æ ·) ä¹‹å‰ï¼Œstore å®ä¾‹æ˜¯ä¸ä¼šè¢«**åˆ›å»º**çš„ï¼š
```js
<script setup>
import { useCounterStore } from '@/stores/counter'
// å¯ä»¥åœ¨ç»„ä»¶ä¸­çš„ä»»æ„ä½ç½®è®¿é—® `store` å˜é‡ âœ¨
const store = useCounterStore()
</script>
```

ä½ å¯ä»¥å®šä¹‰ä»»æ„å¤šçš„ storeï¼Œä½†ä¸ºäº†è®©ä½¿ç”¨ pinia çš„ç›Šå¤„æœ€å¤§åŒ– (æ¯”å¦‚å…è®¸æ„å»ºå·¥å…·è‡ªåŠ¨è¿›è¡Œä»£ç åˆ†å‰²ä»¥åŠ TypeScript æ¨æ–­)ï¼Œä½ åº”è¯¥åœ¨ä¸åŒçš„æ–‡ä»¶ä¸­å»å®šä¹‰ storeã€‚

ä¸€æ—¦ store è¢«å®ä¾‹åŒ–ï¼Œä½ å¯ä»¥ç›´æ¥è®¿é—®åœ¨ store çš„ stateã€getters å’Œ actions ä¸­å®šä¹‰çš„ä»»ä½•å±æ€§ã€‚æˆ‘ä»¬å°†åœ¨åç»­ç« èŠ‚ç»§ç»­äº†è§£è¿™äº›ç»†èŠ‚ï¼Œç›®å‰è‡ªåŠ¨è¡¥å…¨å°†å¸®åŠ©ä½ ä½¿ç”¨ç›¸å…³å±æ€§ã€‚

è¯·æ³¨æ„ï¼Œstore æ˜¯ä¸€ä¸ªç”¨ reactive åŒ…è£…çš„å¯¹è±¡ï¼Œè¿™æ„å‘³ç€ä¸éœ€è¦åœ¨ getters åé¢å†™ .valueã€‚å°±åƒ setup ä¸­çš„ props ä¸€æ ·ï¼Œæˆ‘ä»¬ä¸èƒ½å¯¹å®ƒè¿›è¡Œè§£æ„ï¼š
```js
<script setup>
import { useCounterStore } from '@/stores/counter'
import { computed } from 'vue'

const store = useCounterStore()
// âŒ è¿™å°†ä¸èµ·ä½œç”¨ï¼Œå› ä¸ºå®ƒç ´åäº†å“åº”æ€§
// è¿™å°±å’Œç›´æ¥è§£æ„ `props` ä¸€æ ·
const { name, doubleCount } = store
name // å°†å§‹ç»ˆæ˜¯ "Eduardo" //
doubleCount // å°†å§‹ç»ˆæ˜¯ 0 //
setTimeout(() => {
  store.increment()
}, 1000)
// âœ… è¿™æ ·å†™æ˜¯å“åº”å¼çš„
// ğŸ’¡ å½“ç„¶ä½ ä¹Ÿå¯ä»¥ç›´æ¥ä½¿ç”¨ `store.doubleCount`
const doubleValue = computed(() => store.doubleCount)
</script>
```

#### ä» Store è§£æ„
ä¸ºäº†ä» store ä¸­æå–å±æ€§æ—¶ä¿æŒå…¶å“åº”æ€§ï¼Œä½ éœ€è¦ä½¿ç”¨ storeToRefs()ã€‚å®ƒå°†ä¸ºæ¯ä¸€ä¸ªå“åº”å¼å±æ€§åˆ›å»ºå¼•ç”¨ã€‚å½“ä½ åªä½¿ç”¨ store çš„çŠ¶æ€è€Œä¸è°ƒç”¨ä»»ä½• action æ—¶ï¼Œå®ƒä¼šéå¸¸æœ‰ç”¨ã€‚è¯·æ³¨æ„ï¼Œä½ å¯ä»¥ç›´æ¥ä» store ä¸­è§£æ„ actionï¼Œå› ä¸ºå®ƒä»¬ä¹Ÿè¢«ç»‘å®šåˆ° store ä¸Šï¼š
```js
<script setup>
import { storeToRefs } from 'pinia'
const store = useCounterStore()
// `name` å’Œ `doubleCount` æ˜¯å“åº”å¼çš„ ref
// åŒæ—¶é€šè¿‡æ’ä»¶æ·»åŠ çš„å±æ€§ä¹Ÿä¼šè¢«æå–ä¸º ref
// å¹¶ä¸”ä¼šè·³è¿‡æ‰€æœ‰çš„ action æˆ–éå“åº”å¼ (ä¸æ˜¯ ref æˆ– reactive) çš„å±æ€§
const { name, doubleCount } = storeToRefs(store)
// ä½œä¸º action çš„ increment å¯ä»¥ç›´æ¥è§£æ„
const { increment } = store
</script>
```

### State

åœ¨å¤§å¤šæ•°æƒ…å†µä¸‹ï¼Œstate éƒ½æ˜¯ä½ çš„ store çš„æ ¸å¿ƒã€‚äººä»¬é€šå¸¸ä¼šå…ˆå®šä¹‰èƒ½ä»£è¡¨ä»–ä»¬ APP çš„ stateã€‚åœ¨ Pinia ä¸­ï¼Œstate è¢«å®šä¹‰ä¸ºä¸€ä¸ªè¿”å›åˆå§‹çŠ¶æ€çš„å‡½æ•°ã€‚è¿™ä½¿å¾— Pinia å¯ä»¥åŒæ—¶æ”¯æŒæœåŠ¡ç«¯å’Œå®¢æˆ·ç«¯ã€‚
```js
import { defineStore } from 'pinia'

const useStore = defineStore('storeId', {
  // ä¸ºäº†å®Œæ•´ç±»å‹æ¨ç†ï¼Œæ¨èä½¿ç”¨ç®­å¤´å‡½æ•°
  state: () => {
    return {
      // æ‰€æœ‰è¿™äº›å±æ€§éƒ½å°†è‡ªåŠ¨æ¨æ–­å‡ºå®ƒä»¬çš„ç±»å‹
      count: 0,
      name: 'Eduardo',
      isAdmin: true,
      items: [],
      hasChanged: true,
    }
  },
})
```

#### TypeScriptå…¼å®¹
ä½ å¹¶ä¸éœ€è¦åšå¤ªå¤šåŠªåŠ›å°±èƒ½ä½¿ä½ çš„ state å…¼å®¹ TSã€‚ç¡®ä¿å¯ç”¨äº† strictï¼Œæˆ–è€…è‡³å°‘å¯ç”¨äº† noImplicitThisï¼ŒPinia å°†è‡ªåŠ¨æ¨æ–­æ‚¨çš„çŠ¶æ€ç±»å‹ï¼ ä½†æ˜¯ï¼Œåœ¨æŸäº›æƒ…å†µä¸‹ï¼Œæ‚¨åº”è¯¥å¸®åŠ©å®ƒè¿›è¡Œä¸€äº›è½¬æ¢ï¼š
```js
interface UserInfo {
  name: string
  age: number
}

const useStore = defineStore('storeId', {
  state: () => {
    return {
      // ç”¨äºåˆå§‹åŒ–ç©ºåˆ—è¡¨
      userList: [] as UserInfo[],
      // ç”¨äºå°šæœªåŠ è½½çš„æ•°æ®
      user: null as UserInfo | null,
    }
  },
})

```
å¦‚æœä½ æ„¿æ„ï¼Œä½ å¯ä»¥ç”¨ä¸€ä¸ªæ¥å£å®šä¹‰ stateï¼Œå¹¶æ·»åŠ  state() çš„è¿”å›å€¼çš„ç±»å‹ã€‚
```js
interface UserInfo {
  name: string
  age: number
}

interface State {
  userList: UserInfo[]
  user: UserInfo | null
}

const useStore = defineStore('storeId', {
  state: (): State => {
    return {
      userList: [],
      user: null,
    }
  },
})
```

#### è®¿é—® state
é»˜è®¤æƒ…å†µä¸‹ï¼Œä½ å¯ä»¥é€šè¿‡ store å®ä¾‹è®¿é—® stateï¼Œç›´æ¥å¯¹å…¶è¿›è¡Œè¯»å†™ã€‚
```js
const store = useStore()

store.count++
```
æ³¨æ„ï¼Œæ–°çš„å±æ€§å¦‚æœæ²¡æœ‰åœ¨ state() ä¸­è¢«å®šä¹‰ï¼Œåˆ™ä¸èƒ½è¢«æ·»åŠ ã€‚å®ƒå¿…é¡»åŒ…å«åˆå§‹çŠ¶æ€ã€‚ä¾‹å¦‚ï¼šå¦‚æœ secondCount æ²¡æœ‰åœ¨ state() ä¸­å®šä¹‰ï¼Œæˆ‘ä»¬æ— æ³•æ‰§è¡Œ store.secondCount = 2ã€‚

#### é‡ç½® state
ä½¿ç”¨é€‰é¡¹å¼ API æ—¶ï¼Œä½ å¯ä»¥é€šè¿‡è°ƒç”¨ store çš„ $reset() æ–¹æ³•å°† state é‡ç½®ä¸ºåˆå§‹å€¼ã€‚
```js
const store = useStore()
store.$reset()
```
åœ¨ $reset() å†…éƒ¨ï¼Œä¼šè°ƒç”¨ state() å‡½æ•°æ¥åˆ›å»ºä¸€ä¸ªæ–°çš„çŠ¶æ€å¯¹è±¡ï¼Œå¹¶ç”¨å®ƒæ›¿æ¢å½“å‰çŠ¶æ€ã€‚

åœ¨ Setup Stores ä¸­ï¼Œæ‚¨éœ€è¦åˆ›å»ºè‡ªå·±çš„ $reset() æ–¹æ³•ï¼š
```js
export const useCounterStore = defineStore('counter', () => {
  const count = ref(0)

  function $reset() {
    count.value = 0
  }

  return { count, $reset }
})
```
