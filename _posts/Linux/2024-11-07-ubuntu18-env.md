---
title: "Ubuntu 18.04.6 环境搭建"
description:
date: 2024-11-07 10:00:00 +0800
categories: [Linux]
tags: [Linux, Note]
pin: false

media_subpath: ""
#
# image:
#   path: 'assets/**/**.jpg'
#   alt: Here is the text upder the image
---

## ubuntu

[# 官网历史版本](https://releases.ubuntu.com/?_ga=2.60018285.1101282286.1730883752-1526741234.1730883736)

[# 国内镜像下载](https://mirrors.aliyun.com/ubuntu-releases/)

### 共享文件夹
首先需要先在虚拟机设置上开启共享文件夹

开启后若无共享文件夹显示，则重新安装VMWARE-TOOL  
[# 关于Ubuntu20.04重装VMware Tools的问题](https://blog.csdn.net/qq_44662794/article/details/127519495)  
>
1. 先关闭虚拟机，然后再重新启动，在开始启动还没有进入系统时，点击重新安装vmware tools选项。  
2. 点击安装vmware tools，进入系统后，左边的图标栏会多出一个光盘，点击进入光盘，将里面的压缩包文件VMwareTools-10.3.23-16594550.tar.gz复制到其他文件夹  
3. 解压：  
```bash
tar -xzvf VMwareTools-10.3.23-16594550.tar.gz  
```
4. 进入解压后的文件夹，运行其中的vmware-install.pl文件  
```bash
sudo ./vmware-install.pl  
```
之后会开始安装，这时不要全部回车，注意看提示的内容。  
当看到提示xxxxxx已存在是否覆盖时，一定要输入yes，有三个提示默认的是no  
5. 安装完成后，关闭虚拟机，再启动虚拟机，不要直接点重启。  
6. 启动系统之后，不出意外的话，你应该能在/mnt/hgfs/目录下看到共享目录了（不同版本不一定有效）  

**ubuntu 22版本上述操作无效**    
>安装可能会出现segment fault（VMware的tools版本与Linux版本不匹配导致），安装结束后也没有挂载共享文件夹。   
```bash
# １. 查看所设置的共享目录，是否显示已添加的共享文件夹（若没有，则先在虚拟机配置上进行设置）  
vmware-hgfsclient
# ２. 创建挂载文件夹  
sudo mkdir /mnt/hgfs
# ３. 设置开机自动挂载  
sudo vi /etc/fstab
# 4. 添加以下内容至最后  
.host:/  /mnt/hgfs  fuse.vmhgfs-fuse  allow_other  0  0
# 5. 重启  
reboot  
```

#### 创建文件夹快捷方式至桌面
```bash
ln -s /mnt/hgfs/ubuntu_share/ /home/han/Desktop
ln -s /mnt/hgfs/code_share/ /home/han/Desktop
```

### 关闭自动锁屏
设置-privacy-screen lock

### 语言和输入法（optional）
1. 设置-区域和语言 （安装language-support 安装语言） 切换汉语
2. 设置-键盘 添加智能拼音

### 换源
[# Ubuntu18.04更改国内镜像源（阿里云、网易、清华、中科大）](https://blog.csdn.net/Zander0/article/details/119698368)  

[# 清华源自动生成](https://mirrors.tuna.tsinghua.edu.cn/help/ubuntu/)  
[# 阿里源自动替换](https://developer.aliyun.com/mirror/ubuntu-releases/?spm=a2c6h.25603864.0.0.27f74ddaFukgck)  
```bash
sudo cp -a /etc/apt/sources.list /etc/apt/sources.list.bak

sudo sed -i "s@http://.*archive.ubuntu.com@https://mirrors.aliyun.com/@g" /etc/apt/sources.list
sudo sed -i "s@http://.*security.ubuntu.com@https://mirrors.aliyun.com/@g" /etc/apt/sources.list
```

```bash
sudo apt-get update

sudo apt-get upgrade
```

#### source.list示例
**建议根据ubuntu版本替换，以下示例为18.04版本。**    
```bash
#  清华源
# 默认注释了源码镜像以提高 apt update 速度，如有需要可自行取消注释
deb https://mirrors.tuna.tsinghua.edu.cn/ubuntu/ bionic main restricted universe multiverse
# deb-src https://mirrors.tuna.tsinghua.edu.cn/ubuntu/ bionic main restricted universe multiverse
deb https://mirrors.tuna.tsinghua.edu.cn/ubuntu/ bionic-updates main restricted universe multiverse
# deb-src https://mirrors.tuna.tsinghua.edu.cn/ubuntu/ bionic-updates main restricted universe multiverse
deb https://mirrors.tuna.tsinghua.edu.cn/ubuntu/ bionic-backports main restricted universe multiverse
# deb-src https://mirrors.tuna.tsinghua.edu.cn/ubuntu/ bionic-backports main restricted universe multiverse

# 以下安全更新软件源包含了官方源与镜像站配置，如有需要可自行修改注释切换
deb http://security.ubuntu.com/ubuntu/ bionic-security main restricted universe multiverse
# deb-src http://security.ubuntu.com/ubuntu/ bionic-security main restricted universe multiverse

# 预发布软件源，不建议启用
# deb https://mirrors.tuna.tsinghua.edu.cn/ubuntu/ bionic-proposed main restricted universe multiverse
# # deb-src https://mirrors.tuna.tsinghua.edu.cn/ubuntu/ bionic-proposed main restricted universe multiverse
```

```bash
#  阿里源
deb http://mirrors.aliyun.com/ubuntu/ bionic main restricted universe multiverse
deb http://mirrors.aliyun.com/ubuntu/ bionic-security main restricted universe multiverse
deb http://mirrors.aliyun.com/ubuntu/ bionic-updates main restricted universe multiverse
deb http://mirrors.aliyun.com/ubuntu/ bionic-proposed main restricted universe multiverse
deb http://mirrors.aliyun.com/ubuntu/ bionic-backports main restricted universe multiverse
deb-src http://mirrors.aliyun.com/ubuntu/ bionic main restricted universe multiverse
deb-src http://mirrors.aliyun.com/ubuntu/ bionic-security main restricted universe multiverse
deb-src http://mirrors.aliyun.com/ubuntu/ bionic-updates main restricted universe multiverse
deb-src http://mirrors.aliyun.com/ubuntu/ bionic-proposed main restricted universe multiverse
deb-src http://mirrors.aliyun.com/ubuntu/ bionic-backports main restricted universe multiverse
```

### install
#### vim
```bash
sudo apt-get install vim
```

#### Foxit PDF Reader
[# 如何在 Ubuntu 上安装 Foxit PDF Reader](https://cn.linux-console.net/?p=29655)

```bash
wget https://cdn01.foxitsoftware.com/pub/foxit/reader/desktop/linux/2.x/2.4/en_us/FoxitReader.enu.setup.2.4.4.0911.x64.run.tar.gz

tar -xzf Foxit*.tar.gz

./FoxitReader*.run
```

#### putty
Putty（下载地址： www.putty.org）是一个小巧的多功能绿色工具，可以实现SSH、 telnet、串口等多种协议登录
>[# 【工具】putty下载、安装、使用和常用设置教程](https://blog.csdn.net/crr411422/article/details/131135853)

SSH Secure Client除了能进行远程Shell登录之外，还能通过SSH Secure File Transfer Client进行文件传输。

通过NFS服务，主机将用户指定的目录通过网络共享给目标机（和windows的文件网络共享类似）。目标机可以直接运行存放于Linux主机共享目录下的程序。这样调试程序时十分方便。

TFTP通常用于内核调试。在嵌入式Linux开发过程中，内核调试是其中一个基础、重要的环节。调试内核通常是与Bootloader配合使用，只需在Bootloader中实现了网卡驱动和TFTP客户端，就可以使用TFTP进行内核传输。


### 虚拟机空间不足清理
```bash
#!/bin/bash
# clean-system.sh - Ubuntu 一键清理脚本
# 包含 snap 缓存 + snap 旧版本 + APT 缓存 + 日志

set -e

echo ">>> 停止 snapd 服务"
sudo systemctl stop snapd.socket snapd.service 2>/dev/null || true

echo ">>> 清理 snap 缓存..."
sudo rm -rf /var/lib/snapd/cache/*

echo ">>> 删除所有已禁用的旧版本 snap 包..."
snap list --all | awk '/disabled/{print $1, $2}' | \
while read snapname revision; do
    echo "  - 删除 $snapname (revision $revision)"
    sudo snap remove "$snapname" --revision="$revision"
done

echo ">>> 删除 seed 目录里的无用旧 snap..."
sudo find /var/lib/snapd/seed/snaps -type f -name "*_*.snap" -printf "  - 删除 %f\n" -delete 2>/dev/null || true

echo ">>> 启动 snapd 服务"
sudo systemctl start snapd.socket snapd.service 2>/dev/null || true

echo ">>> 清理 APT 缓存..."
sudo apt-get clean
sudo apt-get autoclean
sudo apt-get autoremove --purge -y

echo ">>> 清理旧日志 (只保留 7 天)..."
sudo journalctl --vacuum-time=7d

echo ">>> 清理完成，当前磁盘使用情况："
df -h /

```

## 开发环境搭建

### 交叉工具链
#### 下载
[gcc-linaro-arm-linux-gnueabihf 各个版本的交叉编译链包下载地址](https://releases.linaro.org/components/toolchain/binaries/)

[gcc-linaro-6.5.0-2018.12-x86_64_arm-linux-gnueabihf.tar.gz](https://releases.linaro.org/components/toolchain/binaries/6.5-2018.12/arm-linux-gnueabihf/)

#### 解压
```bash
tar zxvf gcc-linaro-6.5.0-2018.12-x86_64_arm-linux-gnueabihf.tar.gz -C ~/gcctools
```
以deb或者bin方式发布的工具包，安装后通常会自动设置环境变量；而以.tar.*方式的发布包，在完成解压后，如果不设置环境变量，或者不指定交叉编译器的完整路径，系统是无法找到交叉编译器的。

>交叉编译：在host宿主机上生成target目标机的程序

#### 设置环境变量
```bash
vim ~/.bashrc  
# 在其末尾增加：  
export PATH=/home/han/gcctools/gcc-linaro-6.5.0-2018.12-x86_64_arm-linux-gnueabihf/bin/:$PATH
```

### SSH
SSH实际上是一个Shell，可以通过网络登录远程系统，当然，前提是远程系统已经开启了SSH服务。

>在Windows系统下登录虚拟机的host宿主机或者登录开发板的target目标机

### net-tools 
安装网络工具后可使用ifconfig
```bash
sudo apt-get install net-tools
```

### NFS
通过NFS服务，主机将用户指定的目录通过网络共享给目标机（和windows的文件网络共享类似）。目标机可以直接运行存放于Linux主机共享目录下的程序。这样调试程序时十分方便。
#### 配置 Windows-VMware虚拟Linux主机-开发板场景下的NFS服务
（1） 保证 Windows-VMware虚拟Linux主机-开发板三者能够相互ping通

>**如何能使开发板、windows、Ubuntu相互ping通的同时，Ubuntu还能正常上网？**
>1. 电脑连接WIFI，开发板和电脑通过网线连接
>
>2. 三者设置成静态IP相互ping通，相当于这三方自己组了一个网，电脑与开发板通过有线网卡连接，虚拟机本身的虚拟网络编辑器选择的应该是这个网卡
>
>3. Ubuntu本身可以添加多个网络适配器，总共要添加两个适配器，一个设成NAT模式，用于连接外网；一个设置成桥接模式，用于与开发板通信。这样Ubuntu启动后ifconfig命令可以看到两个网卡，一个是自动获取IP，用于连接外网；另一个是要与开发板通信，配成静态IP。  
（ 如果Ubuntu只留一个网络适配器，那要么连不了外网，要么ping不通开发板）

>配置过程：  
>1. 以管理员身份运行VMware，编辑-虚拟网络编辑器  
>![输入图片说明](/imgs/ubuntu18-env/2024-11-07/WeOmZ0Ve2ya4rq74.png)  
>2. 选择桥接至实际物理网卡（名称根据网卡不同会有不同，根据实际情况判断选择）  
>![输入图片说明](/imgs/ubuntu18-env/2024-11-07/JajJDosYaJpZG6Wp.png)  
>3. 虚拟机设置-添加一个网络适配器  
>![输入图片说明](/imgs/ubuntu18-env/2024-11-07/pDyU1kae1JW4pcqP.png)  
>4. 关闭Windows防火墙  
>![输入图片说明](/imgs/ubuntu18-env/2024-11-07/tV5sAZlWUsE19R6F.png)  
>5. 设置Windows、Ubuntu、开发板三者的静态IP在同一网段，网关和子网掩码相同  
>![输入图片说明](/imgs/ubuntu18-env/2024-11-07/pwYi3CGetUo6Vr6X.png)  
>![输入图片说明](/imgs/ubuntu18-env/2024-11-07/5b6MCUYsh8176waE.png)  
>![输入图片说明](/imgs/ubuntu18-env/2024-11-07/7v5rFveD6lgq01Uo.png)  
>- 如果 ifconfig 无现象，说明网卡没有启动。使用命令`ifconfig -a`查看系统支持的网卡。比如查到有`eth1`网卡，则用`ifconfig eth1 up`命令启用，再次输入`ifconfig`命令就能查到。若需要修改IP，则使用`ifconfig eth1 192.168.2.100 netmask 255.255.255.0`和`route add default gw 192.168.2.1`  
>6. 配置结束后，测试三者可以相互ping通  

（2） 虚拟Linux主机配置NFS服务
```bash
# 1. 安装NFS服务器
sudo apt-get install nfs-kernel-server
# 2. 修改配置文件
sudo vim /etc/exports
# 末尾添加：
/home/han/nfs_dir *(rw,sync,no_root_squash,no_subtree_check)
# 3. 执行以下命令重启NFS服务器，使配置文件生效
sudo /etc/init.d/rpcbind restart 
sudo /etc/init.d/nfs-kernel-server restart
```

（3） 开发板挂载
根据实际情况替换登陆账户  
```bash
mount -o nolock 192.168.2.101:/home/han/nfs_dir /tmp/nfs_dir/
# 或
mount -t nfs -o nolock 192.168.2.101:/home/han/nfs_dir /tmp/nfs_dir/
```

（4）测试：在Ubuntu该目录下生成一个文件，在开发板目录下查看是否同步

（5） 解除挂载
```bash
umount /tmp/nfs_dir/
```

>参考：  
>[# 开发板、电脑主机、Ubunt三者能够相互ping通，同时Ubuntu能连外网](https://blog.csdn.net/m0_37983106/article/details/107682814)  
>[# 开发板通过NFS挂载到虚拟机](https://blog.csdn.net/m0_37983106/article/details/107682438)  

### 测试交叉编译与NFS文件共享
在Ubuntu共享文件夹内编写一段代码，编译后在开发板运行  
来一段hello world，`touch hello.c`并编写代码  
![输入图片说明](/imgs/ubuntu18-env/2024-11-07/OeNVwkgEAFeKymKX.png)  
编译 `arm-linux-gnueabihf-gcc hello.c -o hello`  
Ubuntu目录下新增一个hello程序  
切换至开发板共享目录下，执行  
![输入图片说明](/imgs/ubuntu18-env/2024-11-07/yh8iWQnyhr6xHHcJ.png)  

## Makefile

### make  
要仅安装 `make` 实用程序，请在终端中运行以下命令：  
```bash
sudo apt-get install make
```
我们建议安装 build-essential 包，其中还包括 `make` 以及其他用于构建软件的关键包。在终端中运行以下命令来安装它：
```bash
sudo apt-get install build-essential
```

## VS CODE
软件商城安装vs code（直接在官网下载最新的版本安装可能会失败，Ubuntu 18.04对某些库支持的最新版本太低了，也就是Ubuntu 18.04系统太老，而最新版的vscode可能需要使用更新版本的库，导致安装失败）

> ubuntu22版本可以直接在官网下载.deb包安装并使用`sudo dpkg -i xxx.deb`安装

## ubuntu 安装Git与配置SSH key
```bash
# 安装git：
sudo apt-get install git
git config --global user.name "Your Name"
git config --global user.email "email@example.com"
# 配置ssh key:
ssh-keygen -trsa -C "youremail@example.com"
cd ~/.ssh
#id_rsa是私钥，id_rsa.pub是公钥
#打开id_rsa.pub文件,复制sshkey并添加到git服务器的个人设置中
vim  id_rsa.pub
```

### git clone 报错
若报错：
```
Unable to negotiate with 172.xx.xx.xx port 29418: no matching host key type found. Their offer: ssh-rsa,ssh-dss
fatal: 无法读取远程仓库。

请确认您有正确的访问权限并且仓库存在。
```
意思是：远程 Git 服务器只支持 ssh-rsa / ssh-dss 这类老的 Host Key 算法，而你的 新版本 OpenSSH（>= 8.8） 默认已经禁用了它们，所以协商失败，无法建立 SSH 连接，自然就不能拉取仓库。

解决：在 SSH 配置里启用老的 HostKey 算法  
```
# 编辑 SSH 配置文件：  
vim ~/.ssh/config
```

```
# 添加以下内容：
Host *
    HostkeyAlgorithms +ssh-rsa
    PubkeyAcceptedKeyTypes +ssh-rsa
```

## Remote SSH
- 注意：需要先在ubuntu下载安装ssh服务`sudo apt-get install openssh-server`  

[# vscode通过ssh连接服务器](https://blog.csdn.net/Oxford1151/article/details/137228119)  
配置后可在Windows下使用VScode编辑代码，且不会影响在Linux下的编译  

>开发板-windows-ubuntu互连（结合NFS配置）

方式1：在windows环境下编辑代码  
在windows-vscode通过remoteSSH连接远程服务器后，可以在windows直接使用VSCode的集成终端运行ubuntu上的命令，实现交叉编译；连接开发板时，可以通过SSH客户端（mobaxterm/putty/.etc），也可以在vscode再开一个终端，直接使用`ssh root@192.168.2.100 `连接。

方式2：在ubuntu环境下编辑代码
在ubhuntu上，使用ubuntu-vscode直接编辑代码并编译；部分ssh客户端对linux版本支持不够完善，可以`ssh root@192.168.2.100 `可以直接在虚拟机Ubuntu上访问开发板。
