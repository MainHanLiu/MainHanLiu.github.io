---
title: "任务优先级翻转问题"
description: 
date: 2023-10-28 10:00:00 +0800
categories: [RTOS]
tags: [RTOS, 优先级翻转]
pin: false

media_subpath: ""
#
# image:
#   path: 'assets/**/**.jpg'
#   alt: Here is the text upder the image
---

- 假设 : **优先级 H > M > L**

因为两个任务（L和H）使用了同一个二值信号量，而在这两个任务之间，又有一个中等优先级的任务M，在这种情况下就容易发生优先级翻转。主要就是因为二值信号量产生的，低优先级任务L先占用了信号量没有释放，导致高优先级任务请求信号量时无效，此时高优先级任务无法运行。在这种情况下，任务H的优先级实际上降到了任务L的优先级水平。因为任务 H要一直等待直到任务L释放其占用的那个共享资源。此时，若任务M抢占任务L，任务H的情况更加恶化，这样就相当于任务 M 的优先级高于任务 H，导致优先级翻转。

互斥信号量其实就是一个拥有优先级继承的二值信号量，不同于二值信号量的是互斥信号量具有优先级继承的特性。当一个互斥信号量正在被一个低优先级的任务使用，而此时有个高优先级的任务也尝试获取这个互斥信号量的话就会被阻塞。不过这个高优先级的任务会将低优先级任务的优先级提升到与自己相同的优先级，这个过程就是优先级继承。优先级继承尽可能的降低了高优先级任务处于阻塞态的时间，并且将已经出现的“优先级翻转”的影响降到最低。优先级继承并不能完全的消除优先级翻转，它只是尽可能的降低优先级翻转带来的影响硬实时应用应该在设计之初就要避免优先级翻转的发生。

互斥信号量不能用于中断服务函数中，原因如下：（1）互斥信号量有优先级继承的机制，所以只能用在任务中，不能用于中断服务函数。（2）中断服务函数中不能因为要等待互斥信号量而设置阻塞时间进入阻塞态。

## Reference
- [# 为什么会发生优先级翻转？](https://blog.csdn.net/dingyc_ee/article/details/104115367)
